<!DOCTYPE html>
<html>
<head>
    <title>Paradex Professional Chart</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body { font-family: sans-serif; background: #0b0e11; color: white; margin: 0; padding: 20px; }
        #chart-container { width: 100%; height: 400px; margin-top: 20px; border: 1px solid #2b2f36; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #161a1e; }
        .price-up { color: #00ffcc; font-size: 24px; }
    </style>
</head>
<body>
    <div class="header">
        <div><strong>BTC-USD</strong> - Paradex Dashboard</div>
        <div id="last-price" class="price-up">Loading...</div>
    </div>
    
    <div id="chart-container"></div>

    <script>
        // 1. Inisialisasi Grafik
        const chart = LightweightCharts.createChart(document.getElementById('chart-container'), {
            layout: { backgroundColor: '#0b0e11', textColor: '#d1d4dc' },
            grid: { vertLines: { color: '#1f2226' }, horzLines: { color: '#1f2226' } },
            crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
            timeScale: { timeVisible: true, secondsVisible: true }
        });

        const lineSeries = chart.addLineSeries({
            color: '#00ffcc',
            lineWidth: 2,
        });

        // 2. Fungsi Ambil Data dari API Go
        async function updateData() {
            try {
                const res = await fetch('http://localhost:8080/api/history');
                const data = await res.json();
                
                // Format data untuk library grafik
                const formattedData = data.map(d => ({
                    time: d.time,
                    value: d.price
                }));

                lineSeries.setData(formattedData);
                
                const latest = data[data.length - 1];
                document.getElementById('last-price').innerText = '$ ' + latest.price.toFixed(2);
            } catch (e) {
                console.log("Menunggu koneksi server...");
            }
        }

        // Jalankan update setiap 2 detik
        setInterval(updateData, 2000);
    </script>
</body>
</html>
